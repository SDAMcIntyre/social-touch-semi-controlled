# =============================================================================
# PIPELINE CONFIGURATION & TASK GRAPH (DAG)
# =============================================================================
# Structured to isolate signal extraction and group analysis, now ordered 
# topologically and by sequential STAGE numbering.
# =============================================================================

parameters:
  parallel_execution: false
  kinect_configs_directory: "kinect_configs/valid_configs_ST13-03"

tasks:
  # ---------------------------------------------------------------------------
  # STAGE 1: LED Signal Extraction
  # Isolated processing for TTL/Synchronization LED.
  # ---------------------------------------------------------------------------
  track_led_blinking:
    enabled: false
    options:
      force_processing: false
    depends_on: []

  # ---------------------------------------------------------------------------
  # STAGE 2: Tracking Extraction
  # Stickers and Forearm analysis (Initial data sources).
  # ---------------------------------------------------------------------------
  validate_forearm_extraction:
    enabled: false
    depends_on: []

  # --- Raw 2D Tracking ---  
  track_stickers_raw:
    enabled: false
    options:
      force_processing: false
    depends_on: []

  # --- Sticker Feature Refinement (Depends on Raw Tracking) ---
  refine_sticker_features:
    enabled: false
    options:
      force_processing: false
      monitor: false
    depends_on: [track_stickers_raw]

  generate_xyz_stickers:
    enabled: false
    options:
      force_processing: false
    depends_on: [refine_sticker_features]

  # ---------------------------------------------------------------------------
  # STAGE 3: Trial Definition & Analysis
  # Grouped: Trial ID generation and metadata synthesis. Depends on initial tracking.
  # ---------------------------------------------------------------------------
  define_trial_id:
    enabled: false
    options:
      force_processing: false
    depends_on: [refine_sticker_features]

  generate_stimuli_metadata:
    enabled: false
    options:
      force_processing: false
    depends_on: [define_trial_id]

  # ---------------------------------------------------------------------------
  # STAGE 4: Feature Extraction
  # Hands, touch characteristic analysis, and derived 3D motion.
  # ---------------------------------------------------------------------------
  
  # --- Hand Model Tracking ---
  track_hands_model:
    enabled: true
    options:
      force_processing: false
    depends_on: []

  # --- 3D Kinematics (Depends on Hand Tracking) ---
  generate_3d_hand_in_motion:
    enabled: false
    options:
      force_processing: false
    # Requires base tracking (stickers XYZ), trial context (trial ID), and tracked hands
    depends_on: [generate_xyz_stickers, define_trial_id, track_hands_model]

  validate_hand_extraction:
    enabled: false
    depends_on: [generate_3d_hand_in_motion]

  compute_somatosensory_characteristics:
    enabled: false
    options:
      force_processing: false
      monitor: false
    # Requires forearm validation and 3D hand data
    depends_on: [validate_forearm_extraction, generate_3d_hand_in_motion]

  find_single_touches:
    enabled: false
    options:
      force_processing: false
    # Requires 3D motion, trial context, and stimuli metadata
    depends_on: [generate_3d_hand_in_motion, define_trial_id, generate_stimuli_metadata]

  # ---------------------------------------------------------------------------
  # STAGE 5: Final Unification
  # ---------------------------------------------------------------------------
  unify_processed_data:
    enabled: false
    options:
      force_processing: false
    # Aggregates all processed streams into the final dataset.
    depends_on: 
      - compute_somatosensory_characteristics  # Contact Data
      - track_led_blinking                     # LED Signal
      - define_trial_id                        # Trial Definitions
      - find_single_touches                    # Single Touch Definition
      - generate_stimuli_metadata              # Metadata