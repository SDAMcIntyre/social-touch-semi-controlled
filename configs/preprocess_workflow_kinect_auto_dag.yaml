# =============================================================================
# PIPELINE CONFIGURATION & TASK GRAPH (DAG)
# =============================================================================
# Structured to isolate signal extraction and group analysis, now ordered 
# topologically and by sequential STAGE numbering.
# =============================================================================

parameters:
  parallel_execution: false
  kinect_configs_directory: "kinect_configs/all_valid_configs_ST16-05"

tasks:
  # ---------------------------------------------------------------------------
  # STAGE 1: LED Signal Extraction
  # Isolated processing for TTL/Synchronization LED.
  # ---------------------------------------------------------------------------
  track_led_blinking:
    enabled: true
    options:
      force_processing: false
    depends_on: []

  # ---------------------------------------------------------------------------
  # STAGE 2: Tracking Extraction
  # Stickers and Forearm analysis (Initial data sources).
  # ---------------------------------------------------------------------------
  validate_forearm_extraction:
    enabled: true
    depends_on: []

  track_stickers:
    enabled: true
    options:
      force_processing: false
    depends_on: []

  generate_xyz_stickers:
    enabled: true
    options:
      force_processing: false
    depends_on: [track_stickers]

  # ---------------------------------------------------------------------------
  # STAGE 3: Trial Definition & Analysis
  # Grouped: Trial ID generation and metadata synthesis. Depends on initial tracking.
  # ---------------------------------------------------------------------------
  define_trial_id:
    enabled: true
    options:
      force_processing: false
    depends_on: [track_stickers]

  generate_stimuli_metadata:
    enabled: true
    options:
      force_processing: false
    depends_on: [define_trial_id]

  # ---------------------------------------------------------------------------
  # STAGE 4: Feature Extraction
  # Hands, touch characteristic analysis, and derived 3D motion.
  # ---------------------------------------------------------------------------
  generate_3d_hand_motion:
    enabled: true
    options:
      force_processing: true
    # Requires base tracking (stickers XYZ) and trial context (trial ID)
    depends_on: [generate_xyz_stickers, define_trial_id]

  validate_hand_extraction:
    enabled: true
    depends_on: [generate_3d_hand_motion]

  compute_somatosensory_characteristics:
    enabled: false
    options:
      force_processing: true
      monitor: false
    # Requires forearm validation and 3D hand data
    depends_on: [validate_forearm_extraction, generate_3d_hand_motion]

  find_single_touches:
    enabled: true
    options:
      force_processing: false
    # Requires 3D motion, trial context, and stimuli metadata
    depends_on: [generate_3d_hand_motion, define_trial_id, generate_stimuli_metadata]

  # ---------------------------------------------------------------------------
  # STAGE 5: Final Unification
  # ---------------------------------------------------------------------------
  unify_processed_data:
    enabled: true
    options:
      force_processing: false
    # Aggregates all processed streams into the final dataset.
    depends_on: 
      - compute_somatosensory_characteristics  # Contact Data
      - track_led_blinking                     # LED Signal
      - define_trial_id                        # Trial Definitions
      - find_single_touches                    # Single Touch Definition
      - generate_stimuli_metadata              # Metadata